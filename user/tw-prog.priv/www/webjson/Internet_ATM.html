<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns= "http://www.w3c.org/1999/xhtml">

<head>
<title>D-LINK</title>
<meta http-equiv="X-UA-Compatible" content="IE=9">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Type" content="text/css">
<link rel=stylesheet type="text/css" href="/css/style_h.css" media="all" />
<link rel=stylesheet type="text/css" href="/css/jquery.selectbox.css?v=20160524151219" />
<script type="text/javascript" charset="utf-8" src="/js/initialJS.js?v=20160524151219"></script>
<script type="text/javascript" charset="utf-8" src="/js/initialCSS.js?v=20160524151219"></script>
<script type="text/javascript" charset="utf-8" src="/js/initialJQ.js?v=20160524151219"></script>
<script type="text/javascript" charset="utf-8" src="/js/initialValidate1.js?v=20160524151219"></script>
<style>
#page_btn {
	min-width: 80px;
}
</style>
<script>
$(document).ready(function(){
	presetCheckBox("status", true);
	$("div.checkbox_on" || "div.checkbox_off").click(function(e) {
	 var checkboxId =  e.target.id +'_ck';
		if(e.target.getAttribute("class") == "checkbox_on") {
			var disable = I18N("j","Disabled");
			e.target.setAttribute("class", "checkbox_off");
			e.target.setAttribute("className", "checkbox_off");
			document.getElementById(e.target.id).innerHTML='<input type="checkbox" name=' + e.target.id + ' id=' + checkboxId + ' checked>'+disable;
			document.getElementById(checkboxId).checked=false;
			changeFlag = true;
			save_button_changed();
		}
		else {
			var enable = I18N("j","Enabled");
			e.target.setAttribute("class", "checkbox_on");
			e.target.setAttribute("className", "checkbox_on");
			document.getElementById(e.target.id).innerHTML='<input type="checkbox" name=' + e.target.id + ' id=' + checkboxId + ' checked="">'+enable;
			document.getElementById(checkboxId).checked=true;
			changeFlag = true;
			save_button_changed();
		}
	});
	
	$("#country").selectbox();
	$("#latency").selectbox();
	$("#latency").selectbox();
	$("#encaps").selectbox();
	$("#atmqos").selectbox();
	GetXML();
});
</script>

<script type="text/javascript">
	var HNAP = new HNAP_XML();
	var vpi = 0;
	var vci = 0;
	var atmqos = "";
	var JSON_GetATMSettings;
	function Load_HTML()
	{
		$("#header").load("header.html");
	}

	function Initial()
	{
		initialMenu();
		initialDetectRouterConnection();
	}

	function GetXML()	{	
	var result_xml = new StringDoc();
	HNAP.SetXMLAsync("GetAllDslATMSettings", result_xml, function(xml)	{	GetResult_2nd(xml);	});
	}
	function GetResult_2nd(result_xml)
	{
		//alert("GetResult_2nd");
		var GetResult_2nd = result_xml.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsResult");
		if (GetResult_2nd == "OK")
		{
			JSON_GetATMSettings = result_xml;
			var pvcCount = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists#");
			$("#interface").selectbox('detach');
			$("#interface").children().remove();
			for (var i=1; i<=pvcCount; i++)
			{
				var name = "ATM"+String(pvcCount-1);
				var active = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_pvc_enable");
				var pvc = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_pvc");
				var vpi = pvc.split("/")[0];
				var vci = pvc.split("/")[1];
				if(name.indexOf("ATM")>=0)
				{
					if (active == "1")
					{
						$("#interface").append('<option value="'+ name +'">'+ name +' (' + vpi + '/' + vci + ')</option>');
					}
					else
					{
						$("#interface").append('<option value="'+ name +'">'+ name +'</option>');
					}
				}
			}
			ChangePVC("ATM0");

			$("#interface").selectbox('attach');
			//$("#interface").selectbox();
		}
		else	{	if (DebugMode == 1)	{	alert("[!!GetXML Error!!] Function: GetResult_3rd");	}	}
	}
	function ChangeCountry(country)
	{
		document.getElementById("pvcvpi").disabled = true;
		document.getElementById("pvcvci").disabled = true;

		if (country == "AU")
		{
			document.getElementById("pvcvpi").value = "8";
			document.getElementById("pvcvci").value = "35";
		}
		else if (country == "NZ")
		{
			document.getElementById("pvcvpi").value = "0";
			document.getElementById("pvcvci").value = "100";	
		}
		else
		{
			document.getElementById("pvcvpi").value = vpi;
			document.getElementById("pvcvci").value = vci;
			document.getElementById("pvcvpi").disabled = false;
			document.getElementById("pvcvci").disabled = false;
			
		}
	}

	function changeQoS(atmqos)
	{
		document.getElementById("pcr_block").style.display = "none";
		document.getElementById("scr_block").style.display = "none";
		document.getElementById("mbs_block").style.display = "none";

		switch (atmqos)
		{
			case "UBR+": case "CBR":
				document.getElementById("pcr_block").style.display = "table-row";
				break;
			case "VBR-rt": case "VBR-nrt":
				document.getElementById("pcr_block").style.display = "table-row";
				document.getElementById("scr_block").style.display = "table-row";
				document.getElementById("mbs_block").style.display = "table-row";
				break;
			default:
				break;
		}
	}
	function ChangePVC(index)
	{
		if (index == "ATM0")
		{
			document.getElementById("status_block").style.display = "none";
		}
		else
		{
			document.getElementById("status_block").style.display = "table-row";
		}
		var pvcCount = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists#");
		for (var i=1; i<=pvcCount; i++)
		{
			//var name = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/Name");
			var name = "ATM"+String(i-1);
			if(name == index)
			{
				/*var active = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_atm_enable");
				if (active == "Enable")	
					presetCheckBox("status", true);
				else
					presetCheckBox("status", false);
					*/
				//var country = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_country");
				
				vpi = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_pvc").split("/")[0];
				vci = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_pvc").split("/")[1];
				//ChangeCountry(country);
				//$("#country").selectbox('detach');
				//$("#country").val(country);
				//$("#country").selectbox('attach');
				
				document.getElementById("pvcvpi").value = vpi;
				document.getElementById("pvcvci").value = vci;
				
				var latency = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_latency");
				$("#latency").selectbox('detach');
				$("#latency").val(latency);
				$("#latency").selectbox('attach');

				var encaps = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_atmencaps");
				$("#encaps").selectbox('detach');
				$("#encaps").val(encaps);
				$("#encaps").selectbox('attach');

				atmqos = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_atmqos");
				$("#atmqos").selectbox('detach');
				$("#atmqos").val(atmqos);
				$("#atmqos").selectbox('attach');
				changeQoS(atmqos);

				pcr = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_atmpcr");
				scr = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_atmscr");
				mbs = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_atmmbs");

				document.getElementById("pcr").value = pcr;
				document.getElementById("scr").value = scr;
				document.getElementById("mbs").value = mbs;
			}
		}
		document.getElementById("advancedBlock").style.display = "none";
	}

	function CheckConnectionStatus()
	{
		$.ajax({
			cache : false,
			url : "./js/CheckConnection",
			timeout : 5000,
			type : "GET",
			success : function(data) { SetXML(); },
			error : function() { document.getElementById("DetectRouterConnection").style.display = "inline"; }
		});
	}

	function SetXML()
	{
		SetResult_1st();
	}
	function SetResult_1st()
	{
		var JSON_SetATMSettings = {};
		
		if (document.getElementById("status_ck").checked == true) 
			JSON_SetATMSettings["adsl_wan(0)_pvc_enable"] = "1";
		else 
			JSON_SetATMSettings["adsl_wan(0)_pvc_enable"] = "0";
			
		JSON_SetATMSettings["adsl_wan_unit"] = "0";

		JSON_SetATMSettings["adsl_wan(0)_pvc"] = document.getElementById("pvcvpi").value + "/" + document.getElementById("pvcvci").value;
		JSON_SetATMSettings["adsl_wan(0)_latency"] = document.getElementById("latency").value;
		JSON_SetATMSettings["adsl_wan(0)_atmencaps"] = document.getElementById("encaps").value;
		JSON_SetATMSettings["adsl_wan(0)_atmqos"] = document.getElementById("atmqos").value;
		JSON_SetATMSettings["adsl_wan(0)_atmpcr"] = document.getElementById("pcr").value;
		JSON_SetATMSettings["adsl_wan(0)_atmscr"] = document.getElementById("scr").value;
		JSON_SetATMSettings["adsl_wan(0)_atmmbs"] = document.getElementById("mbs").value;

		HNAP.SetJSONAsync("SetDslATMSettings", null, JSON_SetATMSettings, function(xml)	{	SetResult_2nd(xml);	});
		document.getElementById("CreatePopAlertMessage").style.display = "inline";
		document.getElementById("waitSettingFinish").style.display = "inline";
	}

	function SetResult_2nd(result_xml)
	{
		var SetResult_2nd = result_xml.Get("SetDslATMSettingsResponse/SetDslATMSettingsResult");
		if (SetResult_2nd == "OK")
		{
			setTimeout("waitSettingFinished()", 1000);
		}
		else if (SetResult_2nd == "ERROR")	
		{	
			if (DebugMode == 1)	
			{	
				alert("[!!SetXML Error!!] Function: SetResult_2nd");	
			}	
			setTimeout("waitSettingFinished()", 1000);	
		}
	}
	function waitSettingFinished()	
	{
		window.location.reload();	
	}
	function ReplaceEmpty(element, value)
	{
		element.value = element.value.replace(/\s/g, "");
	}

</script>
<script type="text/javascript">
	$(function() {
		$("select").change(function () {	save_button_changed();	});
		$("input").keydown(function () {	save_button_changed();	});
		$("#interface").unbind();
	});

</script>
</head>

<body>
	<form name="internet_form" id="internet_form" method="POST" action="">
	<div id="wrapper">
		<!-------------------- Logo ------------------------->
		<div id="header"></div>
		<!-------------------- Menu ------------------------->
		<div id="menu"></div>
		<!-------------------- Content ---------------------->
		<div id="content">
		<!-------------------- info ---------------------->
			<div id="info">
				<div id="FunctionName"><script>I18N("h", "ATM");</script></div>
				<div id="wallimage"><img src="image/internet_page.png" alt="" width="195" height="119"/></div>
				<div id="directions">
					<script>I18N("h", "Use this section to configure your ATM Setting.");</script>
				</div>
			</div>
			<!-------------------- funcBar ---------------------->
			<div id="funcBar" style="width:920px">
				<div id="pagePath">&nbsp;<script>I18N("h", "Settings");</script> >> <script>I18N("h", "Internet");</script> >> <script>I18N("h", "ATM");</script></div>
				<ul id="rightFunc">
					<li style="display:block"><div id="Save_btn" onclick="document.getElementById('sumbit_CheckData').click()" style="cursor:pointer; display:none"><script>I18N("h", "Save");</script></div></li>
					<li style="display:block"><div id="Save_Disable_btn"><script>I18N("h", "Save");</script></div></li>
					<input id="sumbit_CheckData" class="submit" type="submit" value="Submit" style="display:none" />
					<li style="display:block"><a href="javascript:CheckHTMLStatus('Internet');" style="text-decoration:none;" onclick="return confirmExit()"><div id="page_btn" class="linkstyle_1"><script>I18N("h", "IPv4");</script></div></a></li>
					<li id="FUNC_IPv6" style="display:block"><a href="javascript:CheckHTMLStatus('Internet_IPv6');" style="text-decoration:none;" onclick="return confirmExit()"><div id="page_btn" class="linkstyle_1"><script>I18N("h", "IPv6");</script></div></a></li>
					<li id="FUNC_Ptm" style="display:block"><a href="javascript:CheckHTMLStatus('Internet_PTM');" style="text-decoration:none;" onclick="return confirmExit()"><div id="page_btn" class="linkstyle_1"><script>I18N("h", "PTM");</script></div></a></li>
					<li id="FUNC_Dsl" style="display:block"><a href="javascript:CheckHTMLStatus('Internet_DSL');" style="text-decoration:none;" onclick="return confirmExit()"><div id="page_btn" class="linkstyle_1"><script>I18N("h", "DSL");</script></div></a></li>
					<li id="FUNC_MultiWAN" style="display:block"><a href="javascript:CheckHTMLStatus('Internet_MultiWAN');" style="text-decoration:none;" onclick="return confirmExit()"><div id="page_btn" class="linkstyle_1"><script>I18N("h", "Multi WAN");</script></div></a></li>
				</ul>
			</div>
			<!-------------------- main ---------------------->
			<br />
			<div id="main">
				<table class="block" border="0">
					<tbody>
						<tr>
							<th><script>I18N("h", "Interface");</script>:</th>
							<td width="202px">
								<div class="styled-select">
									<select id="interface" name="interface" onChange="ChangePVC(this.value)">
									<!--<option value="ATM0">ATM0</option>
									<option value="ATM1">ATM1</option>
									<option value="ATM2">ATM2</option>-->
									</select>
								</div>
							</td>
							<td align=left>
							<img src="image/Infor2.png" style="cursor:pointer;" onclick="document.getElementById('CreatePopAlertMessage').style.display='inline';document.getElementById('popRect').style.display='';document.getElementById('AlertPopRect').style.display='none';">
							</td>
						</tr>
						<tr id="status_block" style="display:none;">
							<th><script>I18N("h", "Status");</script>:</th>
							<td>
								<div id="status" class="checkbox_on">
									<input type="checkbox" id="status_ck" name="status_ck" checked>
								</div>
							</td>
							<td></td>
						</tr>
						<tr id="country_block" style="display:none;">
							<th><script>I18N("h", "Country");</script>:</th>
							<td>
								<div class="styled-select">
									<select id="country" name="country" onChange="ChangeCountry(this.value)">
										<option value="">Not Listed</option>
										<option value="AU">Australia</option>
										<option value="NZ">New Zealand</option>
									</select>
								</div>
							</td>
							<td></td>
						</tr>
						<tr>
							<th><script>I18N("h", "VPI");</script>:</th>
							<td><input class="styled-text" type="text" name="pvcvpi" size="27" maxlength="255" id="pvcvpi" onchange="ReplaceEmpty(this, this.value)"></td>
							<td></td>
						</tr>
						<tr>
							<th><script>I18N("h", "VCI");</script>:</th>
							<td>
								<input class="styled-text" type="text" name="pvcvci" size="27" maxlength="255" id="pvcvci" onchange="ReplaceEmpty(this, this.value)">
								<input class="styled-text" type="text" name="value_Session" size="1" id="value_Session" value="1" style="visibility: hidden; position: absolute; width: 0px; height: 0px;">
							</td>
							<td></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Latency");</script>:</th>
							<td>
								<div class="styled-select">
									<select id="latency" name="latency">
										<option value="Fast">Path0</option>
										<option value="Interleaved">Path1</option>
										<option value="Auto">Path0&Path1</option>
									</select>
								</div>
							</td>
							<td></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Encapsulation");</script>:</th>
							<td>
								<div class="styled-select">
									<select id="encaps" name="encaps">
										<option value="LLC">LLC</option>
										<option value="VCMUX">VC MUX</option>
									</select>
								</div>
							</td>
							<td></td>
						</tr>
					</tbody>
				</table>
			</div>

			

			
			<!-----------------------------------Advanced Settings------------------------------------------------->
			<div class="advButton" onclick="showAdv('advancedBlock');"><script>I18N("h", "Advanced Settings");</script>...</div>
			<hr />
			<div id="advancedBlock" style="display:none">
				<table  class="block" border="0">
					<tbody>
						<tr>
							<th><script>I18N("h", "ATM QoS");</script>:</th>
							<td>
								<div class="styled-select">
									<select id="atmqos" name="atmqos" onChange="changeQoS(this.value)">
										<option value="UBR">UBR Without PCR</option>
										<option value="UBR+">UBR With PCR</option>
										<option value="CBR">CBR</option>
										<option value="VBR-nrt">Non Realtime VBR</option>
										<option value="VBR-rt">Realtime VBR</option>
									</select>
								</div>
							</td>
						</tr>
						<tr id="pcr_block" style="display:none;">
							<th><script>I18N("h", "Peak Cell Rate");</script>:</th>
							<td><input class="styled-text" type="text" name="pcr" size="27" maxlength="255" id="pcr"></td>
						</tr>
						<tr id="scr_block" style="display:none;">
							<th><script>I18N("h", "Sustainable Cell Rate");</script>:</th>
							<td><input class="styled-text" type="text" name="scr" size="27" maxlength="255" id="scr"></td>
						</tr>
						<tr id="mbs_block" style="display:none;">
							<th><script>I18N("h", "Maximum Burst Size");</script>:</th>
							<td><input class="styled-text" type="text" name="mbs" size="27" maxlength="255" id="mbs"></td>
						</tr>
					</tbody>
				</table>	
			</div>
			<div id="CreatePopAlertMessage" style="display:none">
				<div id="popRect" style="display:none">
		 		<div id="dialogBox" style="width: 616px; overflow-x: hidden; overflow-y: auto; max-height: 554px; top: 40px;">
		 			<div id="closeCreatePopBtn" onclick="document.getElementById('CreatePopAlertMessage').style.display='none';document.getElementById('popRect').style.display='none';document.getElementById('AlertPopRect').style.display='';" style="cursor:pointer;"></div>
		 			<div style="padding-top: 80px;font-weight:bold;"><script>I18N("h", "System will auto select ATM/PTM to match ISP xDSL line");</script></div>
		 			<div style="padding-top: 60px;">
		 				<button type="button" class="styled-button_enable" onclick="document.getElementById('CreatePopAlertMessage').style.display='none';document.getElementById('popRect').style.display='none';document.getElementById('AlertPopRect').style.display='';" style="cursor:pointer;">OK</button>
		 			</div>
		 		</div>
		 		</div>
		 		
				<div id="AlertPopRect">
				<div id="AlertPopBody">
					<table class="myAlertPop_table_b" id="waitSettingFinish" border="0" cellspacing="0" style="display:none">
						<tbody>
							<tr>
								<td><center><div id="Loading_pop_image2"></div></center></td>
							</tr>
							<tr>
								<td><label id="reciprocal_Number"></label></td>
							</tr>
							<tr>
								<td id="dialog_msg_black2">
									<script>I18N("h", "Your changes are being saved.");</script>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				</div>
			</div>	
			<div id="DetectRouterConnection" style="display:none"></div>
			<div id="footer">
				<div id="copyright"><script>I18N("h", "COPYRIGHT");</script></div>
			</div>
		</div>
	</div>
	</form>
	<script type="text/javascript" charset="utf-8">
		$(document).ready( function() {
			/* Note: it should return "" if it does not have error check message. */
			$.validator.addMethod("checkSetValues", function( value, element ) {
				var elem_id = element.id;
				var atmqos = document.getElementById("atmqos").value;

				if(elem_id=="pvcvpi")
				{
					if(!COMM_IsInteger(value) || value < 0 || 255 < value)
						return I18N("j", "The VPI value should be 0 ~ 255");
				}
				if(elem_id=="pvcvci")
				{
					if(!COMM_IsInteger(value) || value < 32 || 65535 < value)
						return I18N("j", "The VCI value should be 32 ~ 65535");
				}
				if (elem_id=="value_Session")
				{
				/*
						var check_pvc = document.getElementById("interface").value;	
						var check_vpi = document.getElementById("pvcvpi").value;
						var check_vci = document.getElementById("pvcvci").value;
						var pvc = "";
						var pvcCount = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists#");
						
						var active = "";

						for (var i=1; i<=pvcCount; i++)
						{
							active = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_pvc_enable");
							if (active == "0") continue;
							
							pvc = JSON_GetATMSettings.Get("GetAllDslATMSettingsResponse/GetAllDslATMSettingsLists:" + i + "/adsl_wan(0)_pvc")
							var vpi = pvc.split("/")[0];
							var vci = pvc.split("/")[1];
							
							if (check_vpi == vpi && check_vci == vci && i == (Num(check_pvc.split("ATM")[1]) + 1))
							{
								return I18N("j", "PVC already existed") + " (" + pvc + "), " + I18N("j", "please change the value of VPI/VCI");
							}
						}		
					*/
				}
				if (atmqos != "UBR")
				{
					if(elem_id=="pcr")
					{
						 if (!COMM_IsInteger(value) || value < 1 || 255000 < value)
							return I18N("j", "The value of Peak Cell Rate should be 1 ~ 255000");
					}
				}

				if (atmqos == 'VBR-nrt' || atmqos == 'VBR-rt')
				{
					if(elem_id=="scr")
					{
						var pcr = parseInt(document.getElementById("pcr").value);
						var scr_max = pcr > 255000 ? 255000 : pcr;

						if (!COMM_IsInteger(value) || value < 1 || scr_max < value)
							return I18N("j", "The value of Sustainable Cell Rate should be 1 ~ ") + scr_max;
					}
					if(elem_id=="mbs")
					{
						 if (!COMM_IsInteger(value) || value < 1 || 1000000 < value)
							return I18N("j", "The value of Maximum Burst Size should be 1 ~ 1000000");					
					}
				}
				return "";
			}, "");

			$('#internet_form').validate({
				submitHandler: function(form) {
					CheckConnectionStatus();
				}
			});

			var elements = $("#pvcvpi, #pvcvci, #value_Session, #pcr, #scr, #mbs");
			$.each(elements, function(i, element) {
				$(this).rules("add", { checkSetValues: true });
			});
		});

	</script>
</body>
<script type="text/javascript">
	Load_HTML();
	Initial();
	setMenu("menu_Settings");
	checkTimeout();
</script>
</html>
